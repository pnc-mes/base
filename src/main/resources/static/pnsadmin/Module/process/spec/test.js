//@ sourceURL=msgprompt.js
$(function(){$.ajax({url:getBasePath()+"/Opert/GetAllOpertInfo",type:"POST",data:{"ExecType":"00"},success:function(a){for(var i=0;i<a.Body.Data.length;i++){$("#operts").append("<option label='"+a.Body.Data[i].OpertRd+"' value='"+a.Body.Data[i].OptName+"'/>")}}});$.ajax({url:getBasePath()+"/DeviceG/GetAllDevGInfo",type:"POST",data:{"ExecType":"00"},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){for(var i=0;i<a.Body.Data.length;i++){$("#device").append("<option label='"+a.Body.Data[i].DevGRd+"' value='"+a.Body.Data[i].DevGpName+"'/>")}}}});request({url:"/DC/GetAllDcInfo",async:true,data:{"ExecType":"00"}},function(a){for(var i=0;i<a.Data.length;i++){$("#dataList").append("<option label='"+a.Data[i].DCVerRd+"' value='"+a.Data[i].DcName+"'/>")}});request({url:"/SkillG/GetAllSGInfo",async:true,data:{"ExecType":"00"}},function(a){for(var i=0;i<a.Data.length;i++){$("#skillgs").append("<option label='"+a.Data[i].SGRd+"' value='"+a.Data[i].SGName+"'/>")}});var t=[{"ctlid":"specName","param":"SpecName"},{"ctlid":"version","param":"Version"},{"ctlid":"isDef","param":"IsDef"},{"ctlid":"address","param":"Address"},{"ctlid":"creatPeople","param":"Creator"},{"ctlid":"creatTime","param":"CreateTime"},{"ctlid":"modifyPeople","param":"LastModifyMan"},{"ctlid":"modifyTime","param":"LastModifyTime"},{"ctlid":"beizhu","param":"Remark"}];var u=[];var v=function(){$.ajax({url:getBasePath()+'/Spec/GetAllSpecInfo',type:'POST',async:false,data:{"ExecType":"00"},success:function(b){if(b.Status=="00"&&b.Body.MsgCode=="0x00000"){var c=[];for(var i=0;i<b.Body.Data.length;i++){var d={"id":b.Body.Data[i].SpecRd,"text":b.Body.Data[i].SpecName};c.push(d);u.push(d)}var e={id:"jstree_demo1",data:{source:c,rule:[{id:"id",text:"text",children:"children"}]},event:{onClick:x}};$.JstreeEx.init(e);if(b.Body.Data==null||b.Body.Data==""||b.Body.Data==undefined){$("#specName").val("");$("#specName").attr("readonly",tree);$("#version").val("");$("#version").attr("readonly",tree);$("#dd").val("");$("#dd").attr("checked",false);$("#opert").val("");$("#opert").attr("disabled",tree);$("#device").val("");$("#device").attr("disabled",tree);$("#status").val("");$("#status").attr("disabled",tree);return false};var b={"SpecRd":b.Body.Data[0].SpecRd};$.ajax({url:getBasePath()+"/Spec/GetSVInfo",type:"POST",data:{"ExecType":"00","busData":JSON.stringify(b)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){fillform("aa",t,a.Body.Data);$("#isDef").attr("disabled",true);$("#hidden").attr("r","00");$("#hidden").val(a.Body.Data.SpecRd);$("#hidden").attr("h",a.Body.Data.SpecVerRd);$("#remove").attr("a",a.Body.Data.SpecRd);$("#copy").attr("d",a.Body.Data.SpecRd);$("#DCVerRd").val(a.Body.Data.DC.DCName);$("#skillg").val(a.Body.Data.SkillG.SkillGName);$("#specName").val(a.Body.Data.SpecName);$("#version").val(a.Body.Data.Version);if("00"==a.Body.Data.IsDef){$("#isDef").prop("checked",true);$("#isDef").prop("disabled",true);$("#specName").prop("readonly",false)}if("01"==a.Body.Data.IsDef){$("#isDef").prop("checked",false);$("#isDef").prop("disabled",false);$("#specName").prop("readonly",true)}$("#opert").val(a.Body.Data.Opert.OptName);$("#device1").val(a.Body.Data.Device.DevGpName);if("00"==a.Body.Data.Status){$("#isstatus").val("可用")}if("01"==a.Body.Data.Status){$("#isstatus").val("不可用")}}}})}}})};var w=function(){$.ajax({url:getBasePath()+'/Spec/GetAllSpecInfo',type:'POST',data:{"ExecType":"00"},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){var b=[];for(var i=0;i<a.Body.Data.length;i++){var c={"id":a.Body.Data[i].SpecRd,"text":a.Body.Data[i].SpecName};b.push(c)}var d={id:"jstree_demo1",data:{source:b,rule:[{id:"id",text:"text",children:"children"}]},event:{onClick:x}};$.JstreeEx.init(d)}}})}var x=function(c,d){if(c.isRoot){$("#add").attr("e","");$("#aa").show();$("#addVersion").attr("c",c.nodeID);$("#isDef").attr("disabled",true);$("#remove").attr("a",c.nodeID);$("#hidden").attr("r","00");$("#copy").attr("d",c.nodeID);$("#addVersion").attr("ad","00")var e={"SpecRd":c.nodeID};$.ajax({url:getBasePath()+"/Spec/GetSVTreeInfo",type:"POST",data:{"ExecType":"00","busData":JSON.stringify(e)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){var b=[{id:"SpecVerRd",text:"Version"}];d.ckAddChild(b,a.Body.Data)}}});var f={"SpecRd":c.nodeID};$.ajax({url:getBasePath()+"/Spec/GetSVInfo",type:"POST",data:{"ExecType":"00","busData":JSON.stringify(f)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){fillform("aa",t,a.Body.Data);$("#hidden").val(a.Body.Data.SpecRd);$("#hidden").attr("h",a.Body.Data.SpecVerRd);$("#specName").val(a.Body.Data.SpecName);$("#version").val(a.Body.Data.Version);if("00"==a.Body.Data.IsDef){$("#isDef").prop("checked",true);$("#isDef").prop("disabled",true);$("#specName").prop("readonly",false)}if("01"==a.Body.Data.IsDef){$("#isDef").prop("checked",false);$("#isDef").prop("disabled",false);$("#specName").prop("readonly",true)};$("#opert").val(a.Body.Data.Opert.OptName);$("#DCVerRd").val(a.Body.Data.DC.DCName);$("#skillg").val(a.Body.Data.SkillG.SkillGName);$("#device1").val(a.Body.Data.Device.DevGpName);if("00"==a.Body.Data.Status){$("#isstatus").val("可用")}if("01"==a.Body.Data.Status){$("#isstatus").val("不可用")}}}})}else{$("#add").attr("e","");$("#aa").show();$("#hidden").attr("r","00");$("#addVersion").attr("ad","01");$("#removeVersion").attr("b",c.nodeID);var f={"SpecVerRd":c.nodeID}$.ajax({url:getBasePath()+"/Spec/GetSVInfo",type:"POST",data:{"ExecType":"01","busData":JSON.stringify(f)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){fillform("aa",t,a.Body.Data);$("#hidden").val(a.Body.Data.SpecRd);$("#hidden").attr("h",a.Body.Data.SpecVerRd);$("#specName").val(a.Body.Data.SpecName);$("#version").val(a.Body.Data.Version);if("00"==a.Body.Data.IsDef){$("#isDef").prop("checked",true);$("#isDef").prop("disabled",true);$("#specName").prop("readonly",false)}if("01"==a.Body.Data.IsDef){$("#isDef").prop("checked",false);$("#isDef").prop("disabled",false);$("#specName").prop("readonly",true)}$("#DCVerRd").val(a.Body.Data.DC.DCName);$("#skillg").val(a.Body.Data.SkillG.SkillGName);$("#opert").val(a.Body.Data.Opert.OptName);$("#device1").val(a.Body.Data.Device.DevGpName);if("00"==a.Body.Data.Status){$("#isstatus").val("可用")}if("01"==a.Body.Data.Status){$("#isstatus").val("不可用")}}}})}}$("#add").click(function(){defaultValueForNew();$("#hidden").attr("r","");$("#aa").show();$("#remove").attr("a","");$(this).attr("e","00");$("#DCVerRd").val("");$("#skillg").val("");$("#modify").attr("c","");$("#copy").attr("d","");$("#removeVersion").attr("b","");$("#addVersion").attr("ca","");$("#isDef").attr("checked",true);$("#specName").attr("readonly",false);$("#version").attr("readonly",false);$("#isDef").attr("disabled",false);$("#opert").val("");$("#opert").attr("disabled",false);$("#device1").val("");$("#specName").val("");$("#device").attr("disabled",false);$("#status").val("");$("#status").attr("disabled",false);$("#beizhu").attr("readonly",false);$("#isstatus").val("可用");$("#creatPeople").val("");$("#creatTime").val("");$("#modifyPeople").val("");$("#modifyTime").val("");$("#beizhu").val("")});$("#remove").click(function(){var b=$(this).attr("a");if(b==null||b==""){showWarn("请选择左侧要删除的一项再进行删除!")}else{var c={"SpecRd":b}layer.confirm('确认要删除吗？',{btn:['确认','取消'],},function(){$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"01","BusData":JSON.stringify(c)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){layer.closeAll("dialog");showMsg(a.Body.MsgDes)w();$("#aa").hide();$("#remove").attr("a","");$("#copy").attr("d","")}}})})}});$("#removeVersion").click(function(){var c=$(this).attr("b");if(c==null||c==""){showWarn("请选择左侧要删除的一项再进行删除!")}else{layer.confirm('确认要删除吗？',{btn:['确认','取消'],},function(){var b={"SpecVerRd":c};$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"05","BusData":JSON.stringify(b)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){showMsg(a.Body.MsgDes)w();$("#aa").hide();$("#removeVersion").attr("b","")}}})})}});$("#copy").click(function(){var b=$(this).attr("d");if(b==null||b==""){showWarn("请选择左侧要复制的一项再进行复制!")}else{var c={"SpecRd":b};$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"03","busData":JSON.stringify(c)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){showMsg(a.Body.MsgDes)w();$("#copy").attr("d","");$("#remove").attr("a","")}}})}});$("#addVersion").click(function(){var a=$(this).attr("c");if(a==null||a==""||$(this).attr("ad")=="01"){showWarn("请选择左侧要新增版本的一项再进行新增!")}else{$("#addVersion").attr("a","00");$("#hidden").attr("r","01");$("#aa").show();$("#modify").attr("c","");$("#specName").attr("readonly",true);$("#version").attr("readonly",false);$("#isDef").attr("disabled",false);$("#opert").attr("disabled",false);$("#device").attr("disabled",false);$("#status").attr("disabled",false);$("#beizhu").attr("readonly",false);$("#DCVerRd").val("");$("#skillg").val("");$("#isDef").attr("checked",false);$("#creatPeople").val("");$("#creatTime").val("");$("#modifyPeople").val("");$("#modifyTime").val("");$("#beizhu").val("")}});$("#save").click(function(){var b=$("#specName").val();var c=$("#version").val();var d=$("#beizhu").val();var e=$("#opert").val();var f="";$('#operts option').each(function(){if(e==$(this).val())f=$(this).prop("label")});var g=$("#device1").val();var h="";$('#device option').each(function(){if(g==$(this).val())h=$(this).prop("label")});var i=$("#isstatus").val();var j="";$('#status option').each(function(){if(i==$(this).val())j=$(this).prop("label")});var k=$("#DCVerRd").val();var l="";$('#dataList option').each(function(){if(k==$(this).val())l=$(this).prop("label")});var m=$("#skillg").val();var n="";$('#skillgs option').each(function(){if(m==$(this).val())n=$(this).prop("label")});var o=$("input[type='checkbox']").prop("checked")if(o==true){o="00"}else{o="01"}newData={"SpecName":b,"Version":c,"IsDef":o,"Status":j,"OptRd":f,"DevGpRd":h,"Remark":d,"DCVerRd":l,"SkillGRd":n};if($("#add").attr("e")=="00"){if(b!=""&&b!=null&&c!=null&&c!=""){$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"00","busData":JSON.stringify(newData)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){showMsg(a.Body.MsgDes)w();$("#add").attr("e","")}if(a.Status=="00"&&a.Body.MsgCode=="MG0006F"){showWarn(a.Body.MsgDes)}}})}}if($("#hidden").attr("r")=="00"){var p=$("#hidden").val();var q=$("#hidden").attr("h");newData1={"SpecRd":p,"SpecVerRd":q,"SpecName":b,"Version":c,"IsDef":o,"Status":j,"OptRd":f,"DevGpRd":h,"Remark":d,"DCVerRd":l,"SkillGRd":n};if(b!=""&&b!=null&&c!=null&&c!=""){$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"02","busData":JSON.stringify(newData1)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){showMsg(a.Body.MsgDes)w();$("#hidden").val("");$("#hidden").attr("h","");$("#modify").attr("c","");$("#add").attr("e","");$("#hidden").attr("r","");$("#specName").prop("readonly",false)}if(a.Status=="00"&&a.Body.MsgCode=="MG0006F"){showMsg(a.Body.MsgDes)}if(a.Status=="00"&&a.Body.MsgCode=="MG_MES4001811020007F"){showWarn(a.Body.MsgDes)}}})}}if($("#addVersion").attr("ad")=="00"&&$("#addVersion").attr("a")=="00"){var l="";$('#dataList option').each(function(){if(k==$(this).val())l=$(this).prop("label")});var m=$("#skillg").val();var n="";$('#skillgs option').each(function(){if(m==$(this).val())n=$(this).prop("label")});var b=$("#specName").val();var c=$("#version").val();var d=$("#beizhu").val();var e=$("#opert").val();var f="";$('#operts option').each(function(){if(e==$(this).val())f=$(this).prop("label")});var g=$("#device1").val();var h="";$('#device option').each(function(){if(g==$(this).val())h=$(this).prop("label")});var i=$("#isstatus").val();var j="";$('#status option').each(function(){if(i==$(this).val())j=$(this).prop("label")});if($("input[type='checkbox']").is(':checked')==true){var r="00"}else{var r="01"}var s=$("#remove").attr("a");newData3={"SpecRd":s,"SpecName":b,"Version":c,"IsDef":r,"Status":j,"OptRd":f,"DevGpRd":h,"Remark":d,"DCVerRd":l,"SkillGRd":n};if(b!=""&&b!=null&&c!=null&&c!=""){$.ajax({url:getBasePath()+"/Spec/SaveSpecInfo",type:"POST",data:{"ExecType":"04","busData":JSON.stringify(newData3)},success:function(a){if(a.Status=="00"&&a.Body.MsgCode=="0x00000"){showMsg(a.Body.MsgDes)w();$("#addVersion").attr("c","");$("#addVersion").attr("ad","");$("#addVersion").attr("a","");$("#hidden").attr("r","")}if(a.Status=="00"&&a.Body.MsgCode=="MG_MES4001811020007F"){showWarn(a.Body.MsgDes)}}})}}});var y=u;var z=[];for(var i=0;i<y.length;i++){var A={"id":y[i].id,"name":y[i].text}z.push(A)}$(".input1").keyup(function(a){var b=[]for(var i in z){if(z[i].name.indexOf($(this).val().trim())>=0){var c={"id":z[i].id,"name":z[i].name}b.push(c)}else if($(this).val().trim().length<=0){$("#jstree_demo1").empty();var d={id:"jstree_demo1",data:{source:z,rule:[{id:"id",text:"name"}]},event:{onClick:x}};$.JstreeEx.init(d);break}else{$("#jstree_demo1").empty().html("无记录");$("#jstree_demo1").attr("style","color:red")}}if(b.length>0){$("#jstree_demo1").attr("style","color:#000");$("#jstree_demo1").empty();var e={id:"jstree_demo1",data:{source:b,rule:[{id:"id",text:"name"}]},event:{onClick:x}};$.JstreeEx.init(e)}})})